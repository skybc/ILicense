<Window
    x:Class="LicenseCreate.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:LicenseCreate"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="密钥管理系统 - License Management System"
    Width="1200"
    Height="800"
    MinWidth="1000"
    MinHeight="650"
    FontFamily="Microsoft YaHei UI"
    FontSize="12"
    Icon="密钥管理系统 [48x48].ico"
    ResizeMode="CanResize"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    
    <Window.Resources>
        <!-- Compact Button Style for Small Screens -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#FF007ACC"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF005A9E"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="SuccessButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#FF28A745"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF218838"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="WarningButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#FFFD7E14"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFE8630A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Compact TextBox Style -->
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#FFCCCCCC"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="3">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                        Padding="{TemplateBinding Padding}"
                                        VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#FF007ACC"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Compact GroupBox Style -->
        <Style x:Key="CompactGroupBox" TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="#FFDDDDDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#FF333333"/>
        </Style>

        <!-- Compact Label Style -->
        <Style x:Key="CompactLabel" TargetType="Label">
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="#FF333333"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="0,2"/>
        </Style>
    </Window.Resources>

    <Grid Background="#FFF8F9FA">
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="30"/>
        </Grid.RowDefinitions>

        <!-- Compact Header -->
        <Border Grid.Row="0" Background="#FF2C3E50" Padding="15,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Image Source="密钥管理系统 [48x48].ico" Width="20" Height="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBlock Text="密钥管理系统" FontSize="16" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                </StackPanel>
                <TextBlock Grid.Column="1" Text="版本：3.0.0.0" FontSize="12" Foreground="#FFBDC3C7" VerticalAlignment="Center"/>
            </Grid>
        </Border>

        <!-- Main Content with ScrollViewer for small screens -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"  HorizontalScrollBarVisibility="Disabled" Padding="10">
            <Grid MinWidth="980">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="485"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel -->
                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                    <!-- Key Generation Group -->
                    <GroupBox Header="RSA 密钥对生成" Style="{StaticResource CompactGroupBox}">
                        <StackPanel>
                            <Button x:Name="bCreateKey" Content="● 生成密钥对" Style="{StaticResource ModernButton}" 
                                    FontSize="13" Height="36" Margin="0,0,0,8" Click="BCreateKey_Click"/>
                            
                            <Label Content="公钥 (Public Key):" Style="{StaticResource CompactLabel}" Margin="0,0,0,2"/>
                            <TextBox x:Name="rtpublickey" Style="{StaticResource ModernTextBox}" Height="60" 
                                     AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" 
                                     Margin="0,0,0,8"/>
                            
                            <Label Content="私钥 (Private Key):" Style="{StaticResource CompactLabel}" Margin="0,0,0,2"/>
                            <TextBox x:Name="rtprivatekey" Style="{StaticResource ModernTextBox}" Height="60" 
                                     AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- License Configuration Group -->
                    <GroupBox Header="授权配置" Style="{StaticResource CompactGroupBox}">
                        <StackPanel>
                            <!-- Registration Code -->
                            <Label Content="注册码:" Style="{StaticResource CompactLabel}" Margin="0,0,0,2"/>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="90"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="txtRigisterCode" Grid.Column="0" Style="{StaticResource ModernTextBox}" 
                                         Height="28" Margin="0,0,5,0"/>
                                <Button x:Name="bLocalRigisterCode" Grid.Column="1" Content="获取本机" 
                                        Style="{StaticResource WarningButton}" Height="28" FontSize="10"
                                        Click="BLocalRigisterCode_Click"/>
                            </Grid>

                            <TextBlock Text="⚠️ 注册码必须填写，否则任意用户都可使用" 
                                       Foreground="#FFDC3545" FontSize="10" Margin="0,0,0,8" TextWrapping="Wrap"/>

                            <!-- Customer Name -->
                            <Label Content="被授权人:" Style="{StaticResource CompactLabel}" Margin="0,0,0,2"/>
                            <TextBox x:Name="txtUser" Style="{StaticResource ModernTextBox}" Height="28" Margin="0,0,0,8"/>

                            <!-- Software Code -->
                            <Label Content="软件代号 *:" Style="{StaticResource CompactLabel}" Margin="0,0,0,2"/>
                            <TextBox x:Name="txtsoftcode" Style="{StaticResource ModernTextBox}" Height="28" Margin="0,0,0,8"/>

                            <!-- Expiration Date -->
                            <Label Content="到期时间:" Style="{StaticResource CompactLabel}" Margin="0,0,0,2"/>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="70"/>
                                </Grid.ColumnDefinitions>
                                <DatePicker x:Name="dp" Grid.Column="0" Height="28" VerticalContentAlignment="Center" 
                                            FontSize="12" Margin="0,0,5,0"/>
                                <CheckBox x:Name="cbyj" Grid.Column="1" Content="永久" VerticalAlignment="Center" 
                                          FontWeight="Medium" FontSize="11" Checked="Cbyj_Checked" Unchecked="Cbyj_Unchecked"/>
                            </Grid>

                            <!-- Custom Data -->
                            <Label Content="自定义数据:" Style="{StaticResource CompactLabel}" Margin="0,0,0,2"/>
                            <TextBox x:Name="txt_data" Style="{StaticResource ModernTextBox}" Height="45" 
                                     AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" 
                                     Margin="0,0,0,8"/>

                            <!-- Generate License Button -->
                            <Button x:Name="bCreate" Content="▶ 生成授权密钥" Style="{StaticResource SuccessButton}" 
                                    FontSize="13" Height="36" Click="BCreate_Click"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>

                <!-- Right Panel -->
                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                    <!-- Generated License Group -->
                    <GroupBox Header="生成的授权密钥" Style="{StaticResource CompactGroupBox}">
                        <StackPanel>
                            <Label Content="授权密钥:" Style="{StaticResource CompactLabel}" Margin="0,0,0,5"/>
                            <TextBox  x:Name="txtLicense" Style="{StaticResource ModernTextBox}" Height="160" 
                                     AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" 
                                     IsReadOnly="True" Background="#FFF8F9FA" Margin="0,0,0,8"/>
                            
                            <Button x:Name="bCheck" Content="◉ 验证密钥" Style="{StaticResource ModernButton}" 
                                    Height="32" Click="BCheck_Click"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Quick Actions Group -->
                    <GroupBox Header="快捷操作" Style="{StaticResource CompactGroupBox}">
                        <StackPanel>
                            <Button Content="📋 复制公钥" Style="{StaticResource ModernButton}" Height="28" 
                                    Margin="0,0,0,4" Click="CopyPublicKey_Click"/>
                            <Button Content="📋 复制私钥" Style="{StaticResource ModernButton}" Height="28" 
                                    Margin="0,0,0,4" Click="CopyPrivateKey_Click"/>
                            <Button Content="📋 复制授权密钥" Style="{StaticResource ModernButton}" Height="28" 
                                    Margin="0,0,0,4" Click="CopyLicense_Click"/>
                            <Button Content="💾 保存配置" Style="{StaticResource SuccessButton}" Height="28" 
                                    Click="SaveConfig_Click"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Instructions Group -->
                    <GroupBox Header="使用说明" Style="{StaticResource CompactGroupBox}">
                        <StackPanel>
                            <TextBlock FontSize="10" Foreground="#FF666666" TextWrapping="Wrap" LineHeight="16">
                                <Run Text="1. 点击'生成密钥对'创建RSA密钥"/>
                                <LineBreak/>
                                <Run Text="2. 填写软件代号（必填）"/>
                                <LineBreak/>
                                <Run Text="3. 获取或输入注册码"/>
                                <LineBreak/>
                                <Run Text="4. 设置授权信息和到期时间"/>
                                <LineBreak/>
                                <Run Text="5. 点击'生成授权密钥'"/>
                                <LineBreak/>
                                <Run Text="6. 可复制密钥或保存配置"/>
                            </TextBlock>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Compact Footer -->
        <Border Grid.Row="2" Background="#FF34495E" Padding="15,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="密钥管理系统 - 专业的软件授权管理工具" 
                           Foreground="#FFBDC3C7" VerticalAlignment="Center" FontSize="10"/>
                <TextBlock Grid.Column="1" Text="© 2025 License Management System" 
                           Foreground="#FFBDC3C7" VerticalAlignment="Center" FontSize="10"/>
            </Grid>
        </Border>
    </Grid>
</Window>
